<div class="container py-4">
  <div class="row">
    <div class="col-md-6 col-lg-4 mb-4" *ngFor="let person of deliveryPersons">
      <div class="card delivery-card">
        <div class="card-body">
          <div class="d-flex flex-row align-items-center justify-between">
            <h5 class="card-title">{{ person.userFullName }}</h5>
            @if (person.accountStatus == 'Pending') {
              <div class="text-warning"><i class="bi bi-clock"></i></div>
            } @else if (person.accountStatus == 'Accepted') {
              <div class="text-success"><i class="bi bi-check-circle"></i></div>
            } @else if (person.accountStatus == 'Rejected') {
              <div class="text-danger"><i class="bi bi-x-circle"></i></div>
            }
          </div>
          <p class="card-text text-muted">{{ person.userName }}</p>
          <p><strong>Phone:</strong> {{ person.phoneNumber }}</p>
          <p><strong>City:</strong> {{ person.city }}</p>
          <p><strong>Country:</strong> {{ person.country }}</p>
          <p><strong>Vehicle Type:</strong> {{ person.vehicleType || 'N/A' }}</p>
          <p><strong>Vehicle Number:</strong> {{ person.vehicleNumber || 'N/A' }}</p>
          <p><strong>Role:</strong> {{ person.roleName }}</p>
          <p class="status-badge" [ngClass]="{ 'active': person.isAvailable, 'inactive': !person.isAvailable }">
            {{ person.isAvailable ? 'Available' : 'Unavailable' }}
          </p>

          <button class="btn btn-outline-primary mt-2 w-100" (click)="openDetails(person)">View Details</button>
          <button class="btn btn-outline-success mt-2 w-100" (click)="openEdit(person)">Edit</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- View Modal -->
<div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <button class="modal-close-btn" (click)="closeModal()">×</button>
    <div class="modal-body">
      <h4>{{ selectedPerson?.userFullName }}</h4>
      <p><strong>Username:</strong> {{ selectedPerson?.userName }}</p>
      <p><strong>Phone:</strong> {{ selectedPerson?.phoneNumber }}</p>
      <p><strong>City:</strong> {{ selectedPerson?.city }}</p>
      <p><strong>Country:</strong> {{ selectedPerson?.country }}</p>
      <p><strong>Vehicle:</strong> {{ selectedPerson?.vehicleType || 'N/A' }}</p>
      <p><strong>Number:</strong> {{ selectedPerson?.vehicleNumber || 'N/A' }}</p>
      <p><strong>Status:</strong>
        <span class="status-badge" [ngClass]="{ 'active': selectedPerson?.isAvailable, 'inactive': !selectedPerson?.isAvailable }">
          {{ selectedPerson?.isAvailable ? 'Available' : 'Unavailable' }}
        </span>
      </p>
      <p><strong>Role:</strong> {{ selectedPerson?.roleName }}</p>
    </div>
  </div>
</div>

<!-- Edit Modal -->
<div class="modal-overlay" *ngIf="showEditModal" (click)="closeEditModal()">
  <div class="modal-content short-modal" (click)="$event.stopPropagation()">
    <button class="modal-close-btn" (click)="closeEditModal()">×</button>
    <div class="modal-body">
      <h4>Edit Delivery Person</h4>
      <form (ngSubmit)="saveEdit()" #editForm="ngForm" class="edit-form-grid">
        
        <div class="mb-3">
          <label>Vehicle Number</label>
          <input type="text" class="form-control" [(ngModel)]="editPerson!.vehicleNumber" name="vehicleNumber">
        </div>

        <div class="mb-3">
          <label>Vehicle Type</label>
          <input type="text" class="form-control" [(ngModel)]="editPerson!.vehicleType" name="vehicleType">
        </div>

        <div class="mb-3 full-width">
          <label>Vehicle Image (URL)</label>
          <input type="text" class="form-control" [(ngModel)]="editPerson!.vehicleImage" name="vehicleImage">
        </div>

        <div class="mb-3">
          <label>Phone</label>
          <input type="text" class="form-control" [(ngModel)]="editPerson!.phoneNumber" name="phoneNumber">
        </div>

        <div class="mb-3">
          <label>Status</label>
          <select class="form-control" [(ngModel)]="editPerson!.isAvailable" name="isAvailable">
            <option [ngValue]="true">Available</option>
            <option [ngValue]="false">Unavailable</option>
          </select>
        </div>

        <div class="mb-3">
          <label>City</label>
          <input type="text" class="form-control" [(ngModel)]="editPerson!.city" name="city">
        </div>

        <div class="mb-3">
          <label>Country</label>
          <input type="text" class="form-control" [(ngModel)]="editPerson!.country" name="country">
        </div>

        <div class="mb-3">
          <label>Account Status</label>
          <select class="form-control" [(ngModel)]="editPerson!.accountStatus" name="accountStatus">
            <option value="Pending">Pending</option>
            <option value="Accepted">Accepted</option>
            <option value="Rejected">Rejected</option>
          </select>
        </div>

        <div class="full-width">
          <button class="btn btn-primary w-100" type="submit" [disabled]="editForm.invalid">Save</button>
        </div>

      </form>
    </div>
  </div>
</div>

