<div class="col">
  <div class="card h-100 shadow-sm border-0 rounded-4 overflow-hidden position-relative">
    <img
      [src]="getProductImageUrl()"
      class="card-img-top object-fit-cover"
      [alt]="productC.name"
      (error)="onImgError($event)"
    />

    <div class="card-body d-flex flex-column">
      <h5 class="card-title fw-semibold text-truncate">{{ productC.name }}</h5>
      <p class="card-text small mb-2 text-truncate">{{ productC.description }}</p>
      <p class="mb-2" *ngIf="productC.title"><small>{{ productC.title }}</small></p>

      <div class="d-flex justify-content-between align-items-center mb-3">
        <span class="fw-bold text-primary fs-5">${{ productC.price }}</span>
        <a *ngIf="productC.link" [href]="productC.link" target="_blank" class="btn btn-sm btn-outline-primary">View</a>
      </div>

      <button class="btn btn-sm btn-outline-primary w-100 mt-2" (click)="openModal(productC.id)">
        <i class="bi bi-eye me-2"></i> View Details
      </button>

      <p class="mt-3 mb-0 text-primary text-end small">
        Category: {{ productC.categoryName || "Uncategorized" }}
      </p>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal-backdrop" *ngIf="showModal" (click)="closeModal()"></div>
<div class="modal d-block" *ngIf="showModal">
  <div class="modal-dialog modal-lg">
    <div class="modal-content product-details-wrapper">
      <div class="modal-header border-0 pb-0">
        <h5 class="product-title">{{ modalProduct?.name }}</h5>
        <button type="button" class="btn-close" (click)="closeModal()"></button>
      </div>
      <div class="modal-body" *ngIf="modalProduct">
        <img [src]="getProductImageUrl()" class="product-image" />
        <p class="product-description">{{ modalProduct.description || 'No description provided.' }}</p>

        <div class="product-meta">
          <div><strong>Category:</strong> {{ modalProduct.categoryName || '—' }}</div>
          <div><strong>Subcategory:</strong> {{ modalProduct.subCategoryName || '—' }}</div>
          <div><strong>Status:</strong>
            <span class="badge"
              [ngClass]="{
                'bg-success': modalProduct.status === 'Approved',
                'bg-warning text-dark': modalProduct.status === 'Pending',
                'bg-danger': modalProduct.status === 'Rejected'
              }">
              {{ modalProduct.status }}
            </span>
          </div>
        </div>

        <div class="product-pricing mt-3">
          <ng-container *ngIf="modalProduct.discountPrice && modalProduct.discountPrice < modalProduct.price; else regularPrice">
            <span class="price-discount">${{ modalProduct.discountPrice }}</span>
            <span class="price-original">${{ modalProduct.price }}</span>
          </ng-container>
          <ng-template #regularPrice>
            <span class="price-normal">${{ modalProduct.price }}</span>
          </ng-template>
        </div>

        <div *ngIf="modalProduct.link" class="mt-3 text-center">
          <a [href]="modalProduct.link" target="_blank" class="btn btn-outline-primary btn-sm rounded-pill px-4">
            View on Website <i class="bi bi-box-arrow-up-right ms-1"></i>
          </a>
        </div>
      </div>

      <div class="modal-footer border-0 justify-content-center">
        <button class="btn btn-secondary rounded-pill px-4" (click)="closeModal()">Close</button>
      </div>
    </div>
  </div>
</div>
